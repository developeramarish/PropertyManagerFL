@using PropertyManagerFL.Application.Interfaces.Services.Stats
@using PropertyManagerFL.Core.Entities;
@using Syncfusion.Blazor.Charts

@inject IStringLocalizer<App> localizerApp
@inject IStatsService statsService
@*@attribute [Authorize]*@

<SfAccumulationChart Title="@Titulo" EnableAnimation="true">
    <AccumulationChartTooltipSettings Enable="true"></AccumulationChartTooltipSettings>
    <AccumulationChartLegendSettings Position="Syncfusion.Blazor.Charts.LegendPosition.Bottom" Visible="true"></AccumulationChartLegendSettings>
    <AccumulationChartTitleStyle FontFamily="Arial" FontStyle="Normal" FontWeight="bold"
                                 Color="#99ccff" Size="20px"></AccumulationChartTitleStyle>
    <AccumulationChartSubTitleStyle FontFamily="Arial" FontWeight="regular" Color="#E27F2D" Size="16px"></AccumulationChartSubTitleStyle>
    <AccumulationChartSeriesCollection>
        <AccumulationChartSeries DataSource="@PieData" XName="Descricao" YName="TotalDespesas" Name="Descricao"
                                 Radius="@OuterRadius" StartAngle="@StartAngle" EndAngle="@EndAngle"
                                 InnerRadius="0%" ExplodeIndex="@ExplodeIndex" Explode="true" ExplodeOffset="@ExplodeRadius">
            <AccumulationDataLabelSettings Visible="true"
                                           Name="TotalDespesas" Position="AccumulationLabelPosition.Inside" />
        </AccumulationChartSeries>
        <AccumulationChartTooltipSettings Enable="true"></AccumulationChartTooltipSettings>
    </AccumulationChartSeriesCollection>
</SfAccumulationChart>

@code
{
    [Parameter] public int Ano { get; set; }
    [Parameter] public string? TipoFiltro { get; set; } = "C";  // 'c' - categoria, 'm' - mês
    [Parameter] public string? Titulo { get; set; }

    protected double ExplodeIndex { get; set; } = 0;
    protected string OuterRadius = "70%", ExplodeRadius = "10%";
    protected int StartAngle = 0, EndAngle = 360;
    protected IEnumerable<ExpensesSummaryData>? PieData { get; set; }


    protected override async Task OnParametersSetAsync()
    {
        if (TipoFiltro == "C")
        {
            PieData = await statsService.GetTotalExpenses(Ano);
        }
        else
        {
            PieData = await statsService.GetTotalExpenses_ByYear(Ano);
        }
    }
}
